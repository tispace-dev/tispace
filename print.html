<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>tispace</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">tispace</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="tispace-introduction"><a class="header" href="#tispace-introduction">TiSpace Introduction</a></h1>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>In this project, we will build a system that supports developers to use the K8s Pod as a virtual machine.</p>
<p>The system has the following features:</p>
<ul>
<li>Flexible and user-friendly resource management platform</li>
<li>Highly available and schedulable disk services</li>
<li>Secure Container Runtime for Lightweight Virtual Machines</li>
<li>Delivers consistent performance as standard Linux containers</li>
</ul>
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<p>At PingCAP, our developers use a lot of virtual machines for our development and testing work. However, these virtual machines have poor performance and they are heavily overdraft. In addition, at PingCAP we do not have a good management platform to distribute and manage these VMs for developers. Developers manage and request these machine resources by asking each other. </p>
<p>To optimize these inefficient processes, we decided to develop a management platform to efficiently manage and allocate machine resources.</p>
<h2 id="detailed-design"><a class="header" href="#detailed-design">Detailed design</a></h2>
<p>The whole system uses <a href="https://github.com/kubernetes/kubernetes/">K8s</a> as the infrastructure, and deploys <a href="https://github.com/ceph/ceph">Ceph</a> clusters in <a href="https://github.com/kubernetes/kubernetes/">K8s</a> for disk high availability, and chooses <a href="https://github.com/kata-containers/kata-containers">Kata</a> as the <a href="https://github.com/kubernetes/kubernetes/">K8s</a> container layer to provide good virtualization capability.</p>
<!-- TODO: Add architecture diagram -->
<h3 id="k8s"><a class="header" href="#k8s">K8s</a></h3>
<p>We have deployed <a href="https://github.com/kubernetes/kubernetes/">K8s</a> clusters on bare machine and will rely on <a href="https://github.com/kubernetes/kubernetes/">K8s</a> to provide the scheduling capabilities for the entire system. With this, users only need to provide resource requests when creating instances, and we can use <a href="https://github.com/kubernetes/kubernetes/">K8s</a> scheduling capabilities to create the corresponding Pod resources for users.</p>
<h3 id="ceph"><a class="header" href="#ceph">Ceph</a></h3>
<p><a href="https://github.com/ceph/ceph">Ceph</a> is a distributed storage system that supports object, block, and file storage interfaces. We built a <a href="https://github.com/ceph/ceph">Ceph</a> cluster using <a href="https://github.com/rook/rook">Rook</a> in the <a href="https://github.com/kubernetes/kubernetes/">K8s</a> cluster, using it as a persistent volume resource, and assigning it to each Pod through a persistent volume claim when a user requests an instance. This way, the user's data is automatically guaranteed to be highly available, and the disk resources have the ability to be scheduled.</p>
<p>Finally, we hacked cri-o to allow it to use our mounted persistent volume as the container's rootfs.</p>
<h3 id="kata"><a class="header" href="#kata">Kata</a></h3>
<p>In order to give users a full VM experience, we also needed to provide users with the ability to run docker inside the instance. if we used docker directly at the container layer, we would need to enable privileged mode to allow users to use docker properly, but enabling privileged mode would lead to additional security and resource control risks. So we chose to replace the container layer with <a href="https://github.com/kata-containers/kata-containers">Kata</a>, which provides good isolation while maintaining the same performance as a standard Linux container.</p>
<h3 id="frontend"><a class="header" href="#frontend">Frontend</a></h3>
<p>In order to provide a good interactive experience for users, we built web pages where users can quickly create and destroy instances by logging in with their Google accounts.</p>
<h3 id="backend"><a class="header" href="#backend">Backend</a></h3>
<p>On the backend, we implement an operator-like service application that receives front-end HTTP requests and creates the corresponding Pod based on the requested resource information.</p>
<h2 id="future-possibilities"><a class="header" href="#future-possibilities">Future possibilities</a></h2>
<ul>
<li>Expose K8s capabilities to users so that they can use the tidb-operator directly.</li>
<li>Better integration with TiUP and the ability to quickly deploy clusters with TiUP.</li>
<li>Custom images are supported, and developers can customize their own workflow and toolsets.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
